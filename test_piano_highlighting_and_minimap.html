<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Highlighting and Minimap Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            margin: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        .piano-key {
            background: #fff;
            color: #333;
            border: 1px solid #ccc;
            padding: 15px 10px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
            min-width: 40px;
            text-align: center;
            transition: all 0.2s ease;
        }
        .piano-key:hover {
            background: #f0f0f0;
        }
        .piano-key.playing {
            box-shadow: 0 0 8px 3px rgba(59,130,246,.85);
            outline: 2px solid rgba(59,130,246,.7);
            outline-offset: 2px;
        }
        .minimap {
            width: 100%;
            height: 60px;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .viewport-indicator {
            position: absolute;
            top: 2px;
            bottom: 2px;
            background: rgba(34,197,94,0.3);
            border: 2px solid rgba(34,197,94,0.9);
            border-radius: 2px;
            pointer-events: none;
        }
        .playhead {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255,80,80,0.9);
            pointer-events: none;
        }
        .piano-roll {
            width: 100%;
            height: 200px;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            overflow: auto;
            position: relative;
        }
        .piano-roll-content {
            width: 2000px;
            height: 100%;
            background: linear-gradient(90deg, #243341 0%, #23303c 50%, #243341 100%);
            position: relative;
        }
        .note {
            position: absolute;
            background: #4CAF50;
            border-radius: 2px;
            height: 20px;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border-radius: 8px;
            font-family: monospace;
        }
        .instructions {
            background: #444;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .event-log {
            max-height: 200px;
            overflow-y: auto;
            font-size: 12px;
            background: #333;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Piano Highlighting and Minimap Test</h1>
        
        <div class="instructions">
            <h3>Test Instructions:</h3>
            <h4>Piano Key Highlighting:</h4>
            <ul>
                <li><strong>Click piano keys</strong>: Should highlight with blue glow when clicked</li>
                <li><strong>Highlight duration</strong>: Should stay highlighted for 0.2 seconds</li>
            </ul>
            <h4>Minimap Viewport:</h4>
            <ul>
                <li><strong>Scroll piano roll</strong>: Green viewport box should match current view</li>
                <li><strong>Zoom changes</strong>: Viewport should update when zoom changes</li>
                <li><strong>Playhead</strong>: Red line should show current playback position</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>Piano Key Highlighting Test</h3>
            <p>Click these piano keys to test highlighting:</p>
            <div id="pianoKeys">
                <div class="piano-key" data-note="C">C</div>
                <div class="piano-key" data-note="D">D</div>
                <div class="piano-key" data-note="E">E</div>
                <div class="piano-key" data-note="F">F</div>
                <div class="piano-key" data-note="G">G</div>
                <div class="piano-key" data-note="A">A</div>
                <div class="piano-key" data-note="B">B</div>
            </div>
        </div>

        <div class="test-section">
            <h3>Minimap Viewport Test</h3>
            <p>Scroll the piano roll below to see the minimap viewport update:</p>
            <div class="minimap" id="minimap">
                <div class="viewport-indicator" id="viewportIndicator"></div>
                <div class="playhead" id="playhead"></div>
            </div>
            <div class="piano-roll" id="pianoRoll">
                <div class="piano-roll-content" id="pianoRollContent">
                    <!-- Notes will be added here -->
                </div>
            </div>
            <div style="margin-top: 10px;">
                <label>Zoom: </label>
                <input type="range" id="zoomSlider" min="0.5" max="3" step="0.1" value="1">
                <span id="zoomValue">1.0</span>
            </div>
        </div>

        <div class="test-section">
            <h3>Status</h3>
            <div class="status">
                <div id="status">Ready to test</div>
            </div>
        </div>

        <div class="test-section">
            <h3>Event Log</h3>
            <div id="eventLog" class="event-log"></div>
        </div>
    </div>

    <script>
        let currentZoom = 1.0;
        let playheadPosition = 0;

        function logEvent(event) {
            const log = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `[${timestamp}] ${event}<br>`;
            log.scrollTop = log.scrollHeight;
        }

        function updateStatus() {
            const status = document.getElementById('status');
            status.textContent = `Zoom: ${currentZoom.toFixed(1)}, Playhead: ${playheadPosition.toFixed(0)}px`;
        }

        // Piano key highlighting simulation
        function highlightPianoKey(note, duration = 0.2) {
            const key = document.querySelector(`[data-note="${note}"]`);
            if (key) {
                key.classList.add('playing');
                logEvent(`Piano key ${note} highlighted`);
                
                setTimeout(() => {
                    key.classList.remove('playing');
                    logEvent(`Piano key ${note} highlight removed`);
                }, duration * 1000);
            }
        }

        // Add click handlers to piano keys
        document.querySelectorAll('.piano-key').forEach(key => {
            key.addEventListener('click', () => {
                const note = key.dataset.note;
                highlightPianoKey(note, 0.2);
            });
        });

        // Minimap viewport simulation
        function updateMinimap() {
            const pianoRoll = document.getElementById('pianoRoll');
            const minimap = document.getElementById('minimap');
            const viewportIndicator = document.getElementById('viewportIndicator');
            const playhead = document.getElementById('playhead');
            
            const minimapWidth = minimap.offsetWidth;
            const pianoRollWidth = 2000; // Fixed width for demo
            const scrollLeft = pianoRoll.scrollLeft;
            const viewportWidth = pianoRoll.offsetWidth;
            
            // Calculate viewport position and width
            const viewportStart = (scrollLeft / pianoRollWidth) * minimapWidth;
            const viewportWidthScaled = (viewportWidth / pianoRollWidth) * minimapWidth;
            
            // Update viewport indicator
            viewportIndicator.style.left = viewportStart + 'px';
            viewportIndicator.style.width = viewportWidthScaled + 'px';
            
            // Update playhead
            const playheadX = (playheadPosition / pianoRollWidth) * minimapWidth;
            playhead.style.left = playheadX + 'px';
            
            logEvent(`Minimap updated - Viewport: ${viewportStart.toFixed(0)}-${(viewportStart + viewportWidthScaled).toFixed(0)}, Playhead: ${playheadX.toFixed(0)}`);
        }

        // Add scroll handler to piano roll
        document.getElementById('pianoRoll').addEventListener('scroll', updateMinimap);

        // Zoom slider
        document.getElementById('zoomSlider').addEventListener('input', (e) => {
            currentZoom = parseFloat(e.target.value);
            document.getElementById('zoomValue').textContent = currentZoom.toFixed(1);
            
            // Simulate zoom effect on piano roll content
            const content = document.getElementById('pianoRollContent');
            content.style.transform = `scaleX(${currentZoom})`;
            content.style.transformOrigin = 'left top';
            
            updateMinimap();
            logEvent(`Zoom changed to ${currentZoom.toFixed(1)}`);
            updateStatus();
        });

        // Simulate playhead movement
        function simulatePlayhead() {
            playheadPosition += 2;
            if (playheadPosition > 2000) {
                playheadPosition = 0;
            }
            updateMinimap();
            updateStatus();
        }

        // Add some sample notes to the piano roll
        function addSampleNotes() {
            const content = document.getElementById('pianoRollContent');
            const notes = [
                { note: 'C', x: 100, width: 50 },
                { note: 'E', x: 200, width: 50 },
                { note: 'G', x: 300, width: 50 },
                { note: 'C', x: 500, width: 50 },
                { note: 'D', x: 600, width: 50 },
                { note: 'F', x: 700, width: 50 },
                { note: 'A', x: 800, width: 50 },
                { note: 'C', x: 1000, width: 50 },
                { note: 'E', x: 1100, width: 50 },
                { note: 'G', x: 1200, width: 50 }
            ];
            
            notes.forEach((note, index) => {
                const noteEl = document.createElement('div');
                noteEl.className = 'note';
                noteEl.style.left = note.x + 'px';
                noteEl.style.top = (index * 20) + 'px';
                noteEl.style.width = note.width + 'px';
                noteEl.title = `Note ${note.note}`;
                content.appendChild(noteEl);
            });
        }

        // Initialize
        addSampleNotes();
        updateMinimap();
        updateStatus();
        logEvent('Test started - Click piano keys and scroll piano roll');
        
        // Start playhead simulation
        setInterval(simulatePlayhead, 100);
    </script>
</body>
</html>
